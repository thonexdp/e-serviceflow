# Service Name Change & Mixed-Content Fix

## Changes Made

### 1. Fixed Mixed-Content Error

**File: `app/Providers/AppServiceProvider.php`**

-   Updated to force HTTPS in both `staging` and `production` environments
-   This ensures all assets, links, and forms use HTTPS protocol
-   Prevents browser from blocking HTTP content on HTTPS pages

### 2. Changed Service Name

**File: `.github/workflows/deploy-staging.yml`**

-   Changed `APP_SERVICE_NAME` from `e-serviceflow-app` to `rcprintshoppe`
-   New URL will be: `https://rcprintshoppe-75693930094.asia-southeast1.run.app/`

## Required Actions

### Update GitHub Secrets

You need to update your GitHub repository secrets to match the new service name:

1. Go to your GitHub repository
2. Navigate to **Settings** → **Secrets and variables** → **Actions**
3. Update the following secret:

#### `APP_URL` Secret

-   **Current value**: `https://e-serviceflow-app-75693930094.asia-southeast1.run.app`
-   **New value**: `https://rcprintshoppe-75693930094.asia-southeast1.run.app`

**Note**: The exact URL will be displayed after the first deployment completes. The ID (`75693930094`) might remain the same or change depending on whether Cloud Run creates a new service.

### Deploy the Changes

To apply these changes:

1. **Commit and push to the `staging` branch**:

    ```bash
    git add .
    git commit -m "Fix: Update service name to rcprintshoppe and force HTTPS in staging"
    git push origin staging
    ```

2. **Wait for GitHub Actions to complete** the deployment

3. **Update the APP_URL secret** with the actual URL shown in the deployment output

4. **Trigger a re-deployment** (optional) to ensure the APP_URL is correctly propagated:
    ```bash
    git commit --allow-empty -m "Trigger redeployment with updated APP_URL"
    git push origin staging
    ```

## What These Changes Fix

### Mixed-Content Error ✅

-   All URLs generated by Laravel will use HTTPS
-   Asset URLs, form actions, and redirects will use HTTPS
-   Browser will no longer block "mixed content"

### Service Name ✅

-   Cloud Run service renamed from `e-serviceflow-app` to `rcprintshoppe`
-   URL is more professional and brand-aligned
-   Shorter and easier to remember

## Additional Recommendations

### Content Security Policy (Optional)

If you continue to experience mixed-content issues, you can add this to your `app/Http/Middleware/HandleInertiaRequests.php`:

```php
public function share(Request $request): array
{
    return array_merge(parent::share($request), [
        // ... existing shares
        'app_url' => config('app.url'),
        'asset_url' => asset(''),
    ]);
}
```

### Verify HTTPS Loading

After deployment, verify in your browser's DevTools (F12 → Console) that:

-   No mixed-content warnings appear
-   All assets load over HTTPS
-   The site URL shows a padlock icon

## Troubleshooting

If mixed-content errors persist:

1. **Check database data**: Ensure no hardcoded HTTP URLs in database records
2. **Clear browser cache**: Force refresh with Ctrl+Shift+R
3. **Verify APP_URL**: Make sure the secret is updated correctly
4. **Check external resources**: Ensure any third-party assets use HTTPS
